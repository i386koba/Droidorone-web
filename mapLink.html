<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.

From  https://github.com/nttcom/SkyWay-JS-Sample/tree/master/p2p_broadcast
-->

<html>
<head>
  <meta charset="utf-8">
  <title>DoroiDrone Uesr Map</title>
  <link rel="shortcut icon" href="http://www.cirlution.com/favicon.ico">
  
  <!--link rel="stylesheet" href="style.css"
  Google Map を全画面表示する http://wot.pro.tok2.com/web/api/gmap/view03.html
  -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <style type="text/css">
    html, body {
	height: 100%;
	margin: 0;
	padding: 0;
    }
  </style>
  <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  <script type="text/javascript" src="https://apis.google.com/js/client.js"></script>
  <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCYgefNHuojh9xFK6EAWPDjQc8-x1bg4o0&amp;libraries=geometry"></script>

<script>
//Drive REST API JavaScript Quickstart
//https://developers.google.com/drive/v2/web/quickstart/js
// Your Client ID can be retrieved from your project in the Google
// Developer Console, https://console.developers.google.com
const CLIENT_ID = '233745234921-nv641kj8arbantub6qde76ld1l2pp4jf.apps.googleusercontent.com';
const SCOPES = ['https://www.googleapis.com/auth/drive'];
const MapLinkGDFolderID = '0ByPgjiFncZu1a3B1dEdLVVJzOFk';//\\i386koba\SkyWayRC\MapLink
var gapi;
var google;
//DOM読み込み完了　初期化
google.maps.event.addDomListener(window, 'load', function() {
    var map;
    //日本中心に地図
    var mapOptions = {
       zoom: 2,
       center: new google.maps.LatLng(35, 138), 
       mapTypeId: google.maps.MapTypeId.ROADMAP,
       //mapTypeId: google.maps.MapTypeId.TERRAIN
       noClear: false //http://www.openspc2.org/Google/Maps/api3/Map_option/noClear/
    };
    map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
    // Check if current user has authorized this application.
    gapi.auth.authorize({client_id: CLIENT_ID, scope: SCOPES, immediate: false}, function(authResult) {
        if (authResult && !authResult.error) {
            // Access token has been successfully retrieved, requests can be sent to the API.
            gapi.client.load('drive', 'v2', function () {
                //https://developers.google.com/drive/v2/reference/files/list
                var requestFolder = gapi.client.drive.files.list({
                   q: "'" + MapLinkGDFolderID + "' in parents and mimeType = 'application/vnd.google-apps.folder' and trashed = false"
                });
                requestFolder.execute(function (resp) {
                    console.log("Google drive map link load folder.");
                    //appendPre('Files:');
                    var folders = resp.items;
                    if (folders && folders.length > 0) {
                        for (var i = 0; i < folders.length; i++) {
                            var folder = folders[i];
                            console.log("name:" + folder.title);
                            console.log("description:" + folder.description);
                            var latlng = folder.title.split(',');
                            //https://developers.google.com/maps/documentation/javascript/markers?hl=ja
                            var marker = new google.maps.Marker({
                                position:  new google.maps.LatLng(latlng[0], latlng[1]),
                                title:"Hello World!"
                            });
                            // To add the marker to the map, call setMap();
                            marker.setMap(map);
                        }
                    }
                }); 
                //サインインユーザー名テスト
                //https://developers.google.com/api-client-library/javascript/samples/samples#authorizing-and-making-authorized-requests
                gapi.client.people.people.get(
                        {resourceName: 'people/me'}
                ).then(function(resp) {
                        console.log('Hello, ' + resp.result.names[0].givenName);
                }, function(reason) {
                        console.log('Error: ' + reason.result.error.message);
                });
            });
        } else {
            console.log("Google authResult.error.");
        }
    });
});

</script>

</head>
<body>
<div style="height:100%; background-color: #AAA" id="map-canvas"></div>
</body>
</html>